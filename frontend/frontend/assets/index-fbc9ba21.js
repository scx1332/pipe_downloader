var W=Object.defineProperty;var A=(t,r,n)=>r in t?W(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var b=(t,r,n)=>(A(t,typeof r!="symbol"?r+"":r,n),n);import{r as d,j as e,R as S}from"./react-5cc2acaa.js";import{t as z,c as _}from"./react-dom-3d3b20dc.js";import{P as E}from"./react-bootstrap-eb04db6d.js";/* empty css                  */import{D as m,I}from"./luxon-91c18b66.js";import{p as q}from"./pretty-bytes-a9c69c63.js";import{I as V}from"./react-icons-7e342cba.js";import{B as G}from"./react-router-dom-b23c6dc4.js";import{a as J,b as K}from"./react-router-85631594.js";import"./classnames-5c20d0be.js";import"./scheduler-04ce0582.js";import"./@remix-run-122d521f.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const N=d.createContext({backendSettings:{backendUrl:"",bearerToken:"",enableBearerToken:!1},setBackendSettings:t=>{console.error(`setBackendSettings not implemented: ${t}`)},resetSettings:()=>{console.error("resetSettings not implemented")}}),Q=t=>{const r=window.localStorage.getItem("pipeDownloaderBackendUrl")??"/api",n=window.localStorage.getItem("pipeDownloaderBearerTokenPipe")??"",c=window.localStorage.getItem("pipeDownloaderBearerTokenEnabled")==="1",o={backendUrl:r,bearerToken:n,enableBearerToken:c},[i,s]=d.useState(o),h=d.useCallback(u=>{window.localStorage.setItem("pipeDownloaderBackendUrl",u.backendUrl),window.localStorage.setItem("pipeDownloaderBearerTokenPipe",u.bearerToken),window.localStorage.setItem("pipeDownloaderBearerTokenEnabled",u.enableBearerToken?"1":"0"),s(u)},[s]),l=d.useCallback(()=>{h({backendUrl:"/api",bearerToken:"",enableBearerToken:!1})},[h]);return e.jsx(N.Provider,{value:{backendSettings:i,setBackendSettings:h,resetSettings:l},children:t.children})};function R(t,r,n){const c=(n==null?void 0:n.headers)??new Headers,o=(n==null?void 0:n.method)??"GET",i=n==null?void 0:n.body;let s=r;if(r.startsWith("/"))t.backendUrl.endsWith("/")?s=t.backendUrl+r.substring(1):s=t.backendUrl+r;else throw new Error("Uri must start with /");return t.enableBearerToken&&c.append("Authorization","Bearer "+t.bearerToken),i&&c.append("Content-Type","application/json"),console.log("Calling backend: "+s),fetch(s,{method:o,headers:c,body:i})}class y{constructor(r,n,c){b(this,"config");b(this,"progress");b(this,"error");this.config=r,this.progress=n,this.error=c}}const L=d.createContext(new y(null,"",null)),O=()=>d.useContext(L);function X(){const t=O();if(t.config==null)throw new Error("Config not available");return t.config}const Y=t=>{const[r,n]=d.useState(new y(null,"",null)),{backendSettings:c}=d.useContext(N);return d.useEffect(()=>{(async()=>{const o=c.backendUrl+"/config";n(new y(null,`Connecting to ${o}`,null));let i=null;try{const s=await R(c,"/config");if(s.type==="opaque"){n(new y(null,"",`Failed to connect to ${o} due to CORS policy`));return}i=await s.text();const h=JSON.parse(i);if(!h.config){n(new y(null,"",`No config field found on endpoint ${o} `));return}n(new y(h.config,"",null))}catch(s){console.log("Error fetching config",s),i&&console.log("Response body: ",i),n(new y(null,"",`Failed to connect to ${o}`))}})()},[n,c]),e.jsx(L.Provider,{value:r,children:t.children})};const Z=()=>{const{backendSettings:t,setBackendSettings:r,resetSettings:n}=d.useContext(N),[c,o]=S.useState(t.backendUrl),i=w=>{o(w.target.value)},[s,h]=S.useState(t.bearerToken),[l,u]=S.useState(t.enableBearerToken),g=w=>{u(w.target.checked)},f=w=>{h(w.target.value)},x=()=>{r({backendUrl:c,bearerToken:s,enableBearerToken:l})},v=()=>{o(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)};d.useEffect(()=>{o(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)},[t]);const U=()=>{n()},T=()=>c!==t.backendUrl||s!==t.bearerToken||l!==t.enableBearerToken;return e.jsxs("div",{className:"backend-settings",children:[e.jsx("div",{children:"Backend settings"}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend URL:"}),e.jsx("input",{type:"text",value:c,onChange:i}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend security:"}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bearer authentication"})," - token is added to bearer header value."]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:g}),"Enabled"]})}),e.jsx("input",{type:"text",value:s,onChange:f,disabled:!l}),e.jsx("hr",{}),e.jsxs("div",{className:"box-line",children:[e.jsx("input",{type:"button",value:"Save",onClick:x,disabled:!T()}),e.jsx("input",{type:"button",value:"Cancel",onClick:v,disabled:!T()}),e.jsx("input",{type:"button",value:"Reset to default",onClick:U})]})]})};const B=t=>{const r=m.now(),n=t.date,c=t.title,o="N/A",i="-";let s="Date not yet available";function h(l,u,g,f){return t.minimal?e.jsx("div",{title:f,className:"date-container",children:e.jsx("div",{className:"date-container-date",children:u})}):e.jsxs("div",{title:f,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:l}),e.jsx("div",{className:"date-container-date",children:u}),e.jsx("div",{className:"date-container-msg",children:g})]})}if(n==null)return h(c,o,i,s);try{const l=m.fromISO(n),u=m.now(),g=I.fromDateTimes(l,r),f=I.fromDateTimes(r,l);let x="unknown";g.length("days")>3?x=Math.floor(g.length("days"))+" days ago":g.length("hours")>3?x=Math.floor(g.length("hours"))+" hours ago":g.length("minutes")>3?x=Math.floor(g.length("minutes"))+" min. ago":g.length("seconds")>=0&&(x=Math.floor(g.length("seconds"))+" sec. ago"),f.length("days")>3?x="in "+Math.floor(f.length("days"))+" days":f.length("hours")>3?x="in "+Math.floor(f.length("hours"))+" hours":f.length("minutes")>3?x="in "+Math.floor(f.length("minutes"))+" min.":f.length("seconds")>0&&(x="in "+Math.floor(f.length("seconds"))+" sec.");let v=l.toFormat("yyyy-LL-dd HH:mm:ss");return l.toFormat("yyyy-LL-dd")===u.toFormat("yyyy-LL-dd")&&(v=l.toFormat("HH:mm:ss")),s="Iso date: "+l.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),h(c,v,x,s)}catch(l){return h(c,"error",`${l}`,`${l}`)}};z.Simulate.load;class ee{constructor(r,n){b(this,"chunk");b(this,"chunkNo");b(this,"hidden");b(this,"timeShown");b(this,"timeHidden");this.chunk=r,this.chunkNo=n,this.hidden=!1,this.timeShown=m.now(),this.timeHidden=null}}const k=t=>{const r=n=>q(n,{minimumFractionDigits:3});return e.jsx("span",{title:`${t.bytes} bytes`,children:r(t.bytes)})},ne=t=>{const r=t.chunkWrapper.chunkNo,n=t.chunkWrapper.chunk,[c,o]=d.useState(!1);S.useEffect(()=>{setTimeout(()=>{o(!t.chunkWrapper.hidden)},100)},[t.chunkWrapper.hidden]);const i=n.downloaded/n.toDownload*100;let s="progress-chunk";return c?s+=" progress-chunk-visible":s+=" progress-chunk-hidden",e.jsx("div",{className:s,children:e.jsxs("div",{className:"progress-chunk-inner",children:[e.jsxs("div",{className:"progress-chunk-header",children:[e.jsxs("div",{children:["Chunk no ",r]}),e.jsxs("div",{children:["Downloaded: ",e.jsx(k,{bytes:n.downloaded}),"/",e.jsx(k,{bytes:n.toDownload})]}),e.jsxs("div",{children:["Unpack: ",e.jsx(k,{bytes:n.unpacked}),"/",e.jsx(k,{bytes:n.toUnpack})]})]}),e.jsx(E,{striped:!0,variant:"success",now:i})]})})},te=()=>{const{backendSettings:t}=d.useContext(N),r=X(),[n,c]=d.useState(null),[o,i]=d.useState(0),[s,h]=d.useState({}),[l,u]=d.useState(!1),g=d.useCallback(j=>{for(const p in s){const a=s[p];if(a.chunk.downloaded==a.chunk.toDownload&&a.chunk.unpacked==a.chunk.toUnpack){if(a.timeHidden&&m.now().diff(a.timeHidden,"seconds").seconds>3&&!(p in j.currentChunks)){delete s[p];continue}!a.hidden&&m.now().diff(a.timeShown,"seconds").seconds>2&&(a.hidden=!0,a.timeHidden=m.now())}else p in j.currentChunks?a.chunk=j.currentChunks[p]:(a.chunk.downloaded=a.chunk.toDownload,a.chunk.unpacked=a.chunk.toUnpack)}},[c,s,h,u]),f=d.useCallback(async()=>{try{const p=await(await R(t,"/progress")).json(),a=p.progress;c(p.progress),g(p.progress),(a.finishTime?m.fromISO(a.finishTime):null)&&u(!0);for(const C in a.currentChunks)if(!(C in s)){const M=a.currentChunks[C],$=parseInt(C);s[C]=new ee(M,$)}h(s)}catch(j){console.log(j),c(null)}},[c,s,h,u]);S.useEffect(()=>{l?setTimeout(()=>{i(o+1),n&&g(n)},1e3):f().then(()=>{setTimeout(()=>{i(o+1)},1e3)})},[l,i,o,f]);function x(j,p){return e.jsx(ne,{chunkWrapper:p},j)}if(n==null)return e.jsxs("div",{className:"progress-page",children:[e.jsx("h1",{children:"Vite template"}),e.jsxs("p",{children:["Connected to the endpoint ",t.backendUrl]}),e.jsxs("p",{children:["Frontend version ","0.1.0"]}),e.jsxs("p",{children:["Backend version ",r.version]}),e.jsx("p",{children:"Progress is null"})]});n.finished;const v=n.downloaded/n.totalDownloadSize*100,U=m.fromISO(n.currentTime),T=n.etaSec,w=U.plus({seconds:T}),D=n.finishTime?m.fromISO(n.finishTime):null,H=m.fromISO(n.startTime);return e.jsxs("div",{className:"progress-page",children:[e.jsxs("div",{className:"progress-page-left",children:[e.jsxs("h4",{children:["Pipe downloader ",r.version]}),e.jsxs("p",{children:["endpoint ",t.backendUrl]}),e.jsxs("div",{className:"progress-page-dates",children:[e.jsx(B,{date:n.startTime,title:"Start time",minimal:!1}),e.jsx(B,{date:n.currentTime,title:"Update time",minimal:!1}),n.finishTime?e.jsx(B,{date:n.finishTime,title:"Finish time",minimal:!1}):e.jsx(B,{date:w.toISO(),title:"Estimated finish",minimal:!1})]}),e.jsxs("div",{className:"download-url",children:[e.jsx("div",{className:"header",children:"Downloading file:"}),e.jsx("input",{readOnly:!0,value:n.downloadUrl})]}),D?e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully Downloaded:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.downloaded})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully unpacked:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Elapsed time:"}),e.jsx("td",{children:D.diff(H).toFormat("hh:mm:ss")})]})]})})}):e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Download speed:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.currentDownloadSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpack speed:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.currentUnpackSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Downloaded:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.downloaded}),"/",e.jsx(k,{bytes:n.totalDownloadSize})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpacked:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Percent downloaded:"}),e.jsxs("td",{children:[v.toFixed(5),"%"]})]})]})})}),e.jsx(E,{striped:!0,variant:"success",now:v})]}),e.jsxs("div",{className:"progress-page-right",children:[!n.serverChunkSupport&&e.jsxs("div",{className:"progress-chunk-not-possible",children:[e.jsx(V,{}),e.jsx("div",{className:"progress-chunk-not-possible-label",children:"Multi-connection download not possible due to lack of support on server"})]}),e.jsxs("div",{className:"progress-page-right-header",children:[e.jsxs("div",{children:["Chunks left: ",n.chunksLeft]}),e.jsxs("div",{children:["finished: ",n.chunksTotal-n.chunksLeft]}),e.jsxs("div",{children:["Active: ",Object.keys(s).length]}),e.jsxs("div",{children:["Download threads: ",n.downloadThreads]})]}),Object.entries(s).reverse().map(([j,p])=>x(parseInt(j),p))]})]})},se=()=>{const t=O();return t.error?e.jsxs("div",{children:[e.jsx("div",{children:t.error}),e.jsx(Z,{})]}):t.config==null?e.jsxs("div",{children:["Loading... ",t.progress]}):e.jsx("div",{children:e.jsx("div",{children:e.jsx(te,{})})})},F=document.getElementById("root");if(!F)throw new Error("No root element found");const P=_.createRoot(F),re=document.baseURI;re.includes("/frontend/")?P.render(e.jsx(S.StrictMode,{children:e.jsx(Q,{children:e.jsx(Y,{children:e.jsx(G,{basename:"/frontend/",children:e.jsx(J,{children:e.jsx(K,{path:"/*",element:e.jsx(se,{})})})})})})})):P.render(e.jsx("div",{children:e.jsxs("p",{children:["Invalid base URI, navigate to ","/frontend/"]})}));
