var W=Object.defineProperty;var A=(t,r,n)=>r in t?W(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var b=(t,r,n)=>(A(t,typeof r!="symbol"?r+"":r,n),n);import{r as d,j as e,a as S}from"./react-5c397423.js";import{t as z,c as _}from"./react-dom-9b2ad3b4.js";import{P as E}from"./react-bootstrap-3001cf60.js";/* empty css                  */import{D as k,I as D}from"./luxon-91c18b66.js";import{p as q}from"./pretty-bytes-a9c69c63.js";import{B as V}from"./react-router-dom-f614de17.js";import{a as G,b as J}from"./react-router-2028984d.js";import"./classnames-5c20d0be.js";import"./scheduler-04ce0582.js";import"./@remix-run-122d521f.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const U=d.createContext({backendSettings:{backendUrl:"",bearerToken:"",enableBearerToken:!1},setBackendSettings:t=>{console.error(`setBackendSettings not implemented: ${t}`)},resetSettings:()=>{console.error("resetSettings not implemented")}}),K=t=>{const r=window.localStorage.getItem("backendUrl")??"/api",n=window.localStorage.getItem("bearerToken")??"",c=window.localStorage.getItem("bearerTokenEnabled")==="1",o={backendUrl:r,bearerToken:n,enableBearerToken:c},[i,s]=d.useState(o),h=d.useCallback(u=>{window.localStorage.setItem("backendUrl",u.backendUrl),window.localStorage.setItem("bearerToken",u.bearerToken),window.localStorage.setItem("bearerTokenEnabled",u.enableBearerToken?"1":"0"),s(u)},[s]),a=d.useCallback(()=>{h({backendUrl:"/api",bearerToken:"",enableBearerToken:!1})},[h]);return e.jsx(U.Provider,{value:{backendSettings:i,setBackendSettings:h,resetSettings:a},children:t.children})};function L(t,r,n){const c=(n==null?void 0:n.headers)??new Headers,o=(n==null?void 0:n.method)??"GET",i=n==null?void 0:n.body;let s=r;if(r.startsWith("/"))t.backendUrl.endsWith("/")?s=t.backendUrl+r.substring(1):s=t.backendUrl+r;else throw new Error("Uri must start with /");return t.enableBearerToken&&c.append("Authorization","Bearer "+t.bearerToken),i&&c.append("Content-Type","application/json"),console.log("Calling backend: "+s),fetch(s,{method:o,headers:c,body:i})}class v{constructor(r,n,c){b(this,"config");b(this,"progress");b(this,"error");this.config=r,this.progress=n,this.error=c}}const O=d.createContext(new v(null,"",null)),R=()=>d.useContext(O);function Q(){const t=R();if(t.config==null)throw new Error("Config not available");return t.config}const X=t=>{const[r,n]=d.useState(new v(null,"",null)),{backendSettings:c}=d.useContext(U);return d.useEffect(()=>{(async()=>{const o=c.backendUrl+"/config";n(new v(null,`Connecting to ${o}`,null));let i=null;try{const s=await L(c,"/config");if(s.type==="opaque"){n(new v(null,"",`Failed to connect to ${o} due to CORS policy`));return}i=await s.text();const h=JSON.parse(i);if(!h.config){n(new v(null,"",`No config field found on endpoint ${o} `));return}n(new v(h.config,"",null))}catch(s){console.log("Error fetching config",s),i&&console.log("Response body: ",i),n(new v(null,"",`Failed to connect to ${o}`))}})()},[n,c]),e.jsx(O.Provider,{value:r,children:t.children})};const Y=()=>{const{backendSettings:t,setBackendSettings:r,resetSettings:n}=d.useContext(U),[c,o]=S.useState(t.backendUrl),i=y=>{o(y.target.value)},[s,h]=S.useState(t.bearerToken),[a,u]=S.useState(t.enableBearerToken),g=y=>{u(y.target.checked)},f=y=>{h(y.target.value)},x=()=>{r({backendUrl:c,bearerToken:s,enableBearerToken:a})},w=()=>{o(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)};d.useEffect(()=>{o(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)},[t]);const N=()=>{n()},T=()=>c!==t.backendUrl||s!==t.bearerToken||a!==t.enableBearerToken;return e.jsxs("div",{className:"backend-settings",children:[e.jsx("div",{children:"Backend settings"}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend URL:"}),e.jsx("input",{type:"text",value:c,onChange:i}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend security:"}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bearer authentication"})," - token is added to bearer header value."]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:a,onChange:g}),"Enabled"]})}),e.jsx("input",{type:"text",value:s,onChange:f,disabled:!a}),e.jsx("hr",{}),e.jsxs("div",{className:"box-line",children:[e.jsx("input",{type:"button",value:"Save",onClick:x,disabled:!T()}),e.jsx("input",{type:"button",value:"Cancel",onClick:w,disabled:!T()}),e.jsx("input",{type:"button",value:"Reset to default",onClick:N})]})]})};const B=t=>{const r=k.now(),n=t.date,c=t.title,o="N/A",i="-";let s="Date not yet available";function h(a,u,g,f){return t.minimal?e.jsx("div",{title:f,className:"date-container",children:e.jsx("div",{className:"date-container-date",children:u})}):e.jsxs("div",{title:f,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:a}),e.jsx("div",{className:"date-container-date",children:u}),e.jsx("div",{className:"date-container-msg",children:g})]})}if(n==null)return h(c,o,i,s);try{const a=k.fromISO(n),u=k.now(),g=D.fromDateTimes(a,r),f=D.fromDateTimes(r,a);let x="unknown";g.length("days")>3?x=Math.floor(g.length("days"))+" days ago":g.length("hours")>3?x=Math.floor(g.length("hours"))+" hours ago":g.length("minutes")>3?x=Math.floor(g.length("minutes"))+" min. ago":g.length("seconds")>=0&&(x=Math.floor(g.length("seconds"))+" sec. ago"),f.length("days")>3?x="in "+Math.floor(f.length("days"))+" days":f.length("hours")>3?x="in "+Math.floor(f.length("hours"))+" hours":f.length("minutes")>3?x="in "+Math.floor(f.length("minutes"))+" min.":f.length("seconds")>0&&(x="in "+Math.floor(f.length("seconds"))+" sec.");let w=a.toFormat("yyyy-LL-dd HH:mm:ss");return a.toFormat("yyyy-LL-dd")===u.toFormat("yyyy-LL-dd")&&(w=a.toFormat("HH:mm:ss")),s="Iso date: "+a.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),h(c,w,x,s)}catch(a){return h(c,"error",`${a}`,`${a}`)}};z.Simulate.load;class Z{constructor(r,n){b(this,"chunk");b(this,"chunkNo");b(this,"hidden");b(this,"timeShown");b(this,"timeHidden");this.chunk=r,this.chunkNo=n,this.hidden=!1,this.timeShown=k.now(),this.timeHidden=null}}const j=t=>{const r=n=>q(n,{minimumFractionDigits:3});return e.jsx("span",{title:`${t.bytes} bytes`,children:r(t.bytes)})},ee=t=>{const r=t.chunkWrapper.chunkNo,n=t.chunkWrapper.chunk,[c,o]=d.useState(!1);S.useEffect(()=>{setTimeout(()=>{o(!t.chunkWrapper.hidden)},100)},[t.chunkWrapper.hidden]);const i=n.downloaded/n.toDownload*100;let s="progress-chunk";return c?s+=" progress-chunk-visible":s+=" progress-chunk-hidden",e.jsx("div",{className:s,children:e.jsxs("div",{className:"progress-chunk-inner",children:[e.jsxs("div",{className:"progress-chunk-header",children:[e.jsxs("div",{children:["Chunk no ",r]}),e.jsxs("div",{children:["Downloaded: ",e.jsx(j,{bytes:n.downloaded}),"/",e.jsx(j,{bytes:n.toDownload})]}),e.jsxs("div",{children:["Unpack: ",e.jsx(j,{bytes:n.toUnpack}),"/",e.jsx(j,{bytes:n.unpacked})]})]}),e.jsx(E,{striped:!0,variant:"success",now:i})]})})},ne=()=>{const{backendSettings:t}=d.useContext(U),r=Q(),[n,c]=d.useState(null),[o,i]=d.useState(0),[s,h]=d.useState({}),[a,u]=d.useState(!1),g=d.useCallback(p=>{for(const m in s){const l=s[m];if(l.chunk.downloaded==l.chunk.toDownload&&l.chunk.unpacked==l.chunk.toUnpack){if(l.timeHidden&&k.now().diff(l.timeHidden,"seconds").seconds>3&&!(m in p.currentChunks)){delete s[m];continue}!l.hidden&&k.now().diff(l.timeShown,"seconds").seconds>2&&(l.hidden=!0,l.timeHidden=k.now())}else m in p.currentChunks?l.chunk=p.currentChunks[m]:(l.chunk.downloaded=l.chunk.toDownload,l.chunk.unpacked=l.chunk.toUnpack)}},[c,s,h,u]),f=d.useCallback(async()=>{try{const m=await(await L(t,"/progress")).json(),l=m.progress;c(m.progress),g(m.progress),(l.finishTime?k.fromISO(l.finishTime):null)&&u(!0);for(const C in l.currentChunks)if(!(C in s)){const $=l.currentChunks[C],M=parseInt(C);s[C]=new Z($,M)}h(s)}catch(p){console.log(p),c(null)}},[c,s,h,u]);S.useEffect(()=>{a?setTimeout(()=>{i(o+1),n&&g(n)},1e3):f().then(()=>{setTimeout(()=>{i(o+1)},1e3)})},[a,i,o,f]);function x(p,m){return e.jsx(ee,{chunkWrapper:m},p)}if(n==null)return e.jsxs("div",{className:"progress-page",children:[e.jsx("h1",{children:"Vite template"}),e.jsxs("p",{children:["Connected to the endpoint ",t.backendUrl]}),e.jsxs("p",{children:["Frontend version ","0.1.0"]}),e.jsxs("p",{children:["Backend version ",r.version]}),e.jsx("p",{children:"Progress is null"})]});n.finished;const w=n.downloaded/n.totalDownloadSize*100,N=k.fromISO(n.currentTime),T=n.etaSec,y=N.plus({seconds:T}),I=n.finishTime?k.fromISO(n.finishTime):null,H=k.fromISO(n.startTime);return e.jsxs("div",{className:"progress-page",children:[e.jsxs("div",{className:"progress-page-left",children:[e.jsxs("h4",{children:["Pipe downloader ",r.version]}),e.jsxs("p",{children:["endpoint ",t.backendUrl]}),e.jsxs("div",{className:"progress-page-dates",children:[e.jsx(B,{date:n.startTime,title:"Start time",minimal:!1}),e.jsx(B,{date:n.currentTime,title:"Update time",minimal:!1}),n.finishTime?e.jsx(B,{date:n.finishTime,title:"Finish time",minimal:!1}):e.jsx(B,{date:y.toISO(),title:"Estimated finish",minimal:!1})]}),e.jsxs("div",{className:"download-url",children:[e.jsx("div",{className:"header",children:"Downloading file:"}),e.jsx("input",{readOnly:!0,value:n.downloadUrl})]}),I?e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully Downloaded:"}),e.jsx("td",{children:e.jsx(j,{bytes:n.downloaded})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully unpacked:"}),e.jsx("td",{children:e.jsx(j,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Elapsed time:"}),e.jsx("td",{children:I.diff(H).toFormat("hh:mm:ss")})]})]})})}):e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Download speed:"}),e.jsxs("td",{children:[e.jsx(j,{bytes:n.currentDownloadSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpack speed:"}),e.jsxs("td",{children:[e.jsx(j,{bytes:n.currentUnpackSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Downloaded:"}),e.jsxs("td",{children:[e.jsx(j,{bytes:n.downloaded}),"/",e.jsx(j,{bytes:n.totalDownloadSize})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpacked:"}),e.jsx("td",{children:e.jsx(j,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Percent downloaded:"}),e.jsxs("td",{children:[w.toFixed(5),"%"]})]})]})})}),e.jsx(E,{striped:!0,variant:"success",now:w})]}),e.jsxs("div",{className:"progress-page-right",children:[e.jsxs("p",{children:["Chunks left: ",n.chunksLeft," finished: ",n.chunksTotal-n.chunksLeft," Active: ",Object.keys(s).length]}),Object.entries(s).reverse().map(([p,m])=>x(parseInt(p),m))]})]})},te=()=>{const t=R();return t.error?e.jsxs("div",{children:[e.jsx("div",{children:t.error}),e.jsx(Y,{})]}):t.config==null?e.jsxs("div",{children:["Loading... ",t.progress]}):e.jsx("div",{children:e.jsx("div",{children:e.jsx(ne,{})})})},F=document.getElementById("root");if(!F)throw new Error("No root element found");const P=_.createRoot(F),se=document.baseURI;se.includes("/frontend/")?P.render(e.jsx(S.StrictMode,{children:e.jsx(K,{children:e.jsx(X,{children:e.jsx(V,{basename:"/frontend/",children:e.jsx(G,{children:e.jsx(J,{path:"/*",element:e.jsx(te,{})})})})})})})):P.render(e.jsx("div",{children:e.jsxs("p",{children:["Invalid base URI, navigate to ","/frontend/"]})}));
