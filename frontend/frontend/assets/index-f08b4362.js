var z=Object.defineProperty;var A=(s,t,n)=>t in s?z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var b=(s,t,n)=>(A(s,typeof t!="symbol"?t+"":t,n),n);import{r as d,j as e,R as S}from"./react-5cc2acaa.js";import{c as _}from"./react-dom-ffb09b4b.js";import{P as F}from"./react-bootstrap-eb04db6d.js";/* empty css                  */import{D as j,I}from"./luxon-91c18b66.js";import{p as q}from"./pretty-bytes-a9c69c63.js";import{I as V}from"./react-icons-7e342cba.js";import{B as G}from"./react-router-dom-b23c6dc4.js";import{a as J,b as K}from"./react-router-85631594.js";import"./classnames-5c20d0be.js";import"./scheduler-04ce0582.js";import"./@remix-run-122d521f.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const U=d.createContext({backendSettings:{backendUrl:"",bearerToken:"",enableBearerToken:!1},setBackendSettings:s=>{console.error(`setBackendSettings not implemented: ${s}`)},resetSettings:()=>{console.error("resetSettings not implemented")}}),Q=s=>{const t=window.localStorage.getItem("pipeDownloaderBackendUrl")??"/api",n=window.localStorage.getItem("pipeDownloaderBearerTokenPipe")??"",c=window.localStorage.getItem("pipeDownloaderBearerTokenEnabled")==="1",o={backendUrl:t,bearerToken:n,enableBearerToken:c},[i,r]=d.useState(o),h=d.useCallback(u=>{window.localStorage.setItem("pipeDownloaderBackendUrl",u.backendUrl),window.localStorage.setItem("pipeDownloaderBearerTokenPipe",u.bearerToken),window.localStorage.setItem("pipeDownloaderBearerTokenEnabled",u.enableBearerToken?"1":"0"),r(u)},[r]),l=d.useCallback(()=>{h({backendUrl:"/api",bearerToken:"",enableBearerToken:!1})},[h]);return e.jsx(U.Provider,{value:{backendSettings:i,setBackendSettings:h,resetSettings:l},children:s.children})};function E(s,t,n){const c=(n==null?void 0:n.headers)??new Headers,o=(n==null?void 0:n.method)??"GET",i=n==null?void 0:n.body;let r=t;if(t.startsWith("/"))s.backendUrl.endsWith("/")?r=s.backendUrl+t.substring(1):r=s.backendUrl+t;else throw new Error("Uri must start with /");return s.enableBearerToken&&c.append("Authorization","Bearer "+s.bearerToken),i&&c.append("Content-Type","application/json"),console.log("Calling backend: "+r),fetch(r,{method:o,headers:c,body:i})}class v{constructor(t,n,c){b(this,"config");b(this,"progress");b(this,"error");this.config=t,this.progress=n,this.error=c}}const L=d.createContext(new v(null,"",null)),R=()=>d.useContext(L);function X(){const s=R();if(s.config==null)throw new Error("Config not available");return s.config}const Y=s=>{const[t,n]=d.useState(new v(null,"",null)),{backendSettings:c}=d.useContext(U);return d.useEffect(()=>{(async()=>{const o=c.backendUrl+"/config";n(new v(null,`Connecting to ${o}`,null));let i=null;try{const r=await E(c,"/config");if(r.type==="opaque"){n(new v(null,"",`Failed to connect to ${o} due to CORS policy`));return}i=await r.text();const h=JSON.parse(i);if(!h.config){n(new v(null,"",`No config field found on endpoint ${o} `));return}n(new v(h.config,"",null))}catch(r){console.log("Error fetching config",r),i&&console.log("Response body: ",i),n(new v(null,"",`Failed to connect to ${o}`))}})()},[n,c]),e.jsx(L.Provider,{value:t,children:s.children})};const Z=()=>{const{backendSettings:s,setBackendSettings:t,resetSettings:n}=d.useContext(U),[c,o]=S.useState(s.backendUrl),i=y=>{o(y.target.value)},[r,h]=S.useState(s.bearerToken),[l,u]=S.useState(s.enableBearerToken),m=y=>{u(y.target.checked)},x=y=>{h(y.target.value)},g=()=>{t({backendUrl:c,bearerToken:r,enableBearerToken:l})},w=()=>{o(s.backendUrl),h(s.bearerToken),u(s.enableBearerToken)};d.useEffect(()=>{o(s.backendUrl),h(s.bearerToken),u(s.enableBearerToken)},[s]);const T=()=>{n()},C=()=>c!==s.backendUrl||r!==s.bearerToken||l!==s.enableBearerToken;return e.jsxs("div",{className:"backend-settings",children:[e.jsx("div",{children:"Backend settings"}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend URL:"}),e.jsx("input",{type:"text",value:c,onChange:i}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend security:"}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bearer authentication"})," - token is added to bearer header value."]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:m}),"Enabled"]})}),e.jsx("input",{type:"text",value:r,onChange:x,disabled:!l}),e.jsx("hr",{}),e.jsxs("div",{className:"box-line",children:[e.jsx("input",{type:"button",value:"Save",onClick:g,disabled:!C()}),e.jsx("input",{type:"button",value:"Cancel",onClick:w,disabled:!C()}),e.jsx("input",{type:"button",value:"Reset to default",onClick:T})]})]})};const B=s=>{const t=j.now(),n=s.date,c=s.title,o="N/A",i="-";let r="Date not yet available";function h(l,u,m,x){return s.minimal?e.jsx("div",{title:x,className:"date-container",children:e.jsx("div",{className:"date-container-date",children:u})}):e.jsxs("div",{title:x,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:l}),e.jsx("div",{className:"date-container-date",children:u}),e.jsx("div",{className:"date-container-msg",children:m})]})}if(n==null)return h(c,o,i,r);try{const l=j.fromISO(n),u=j.now(),m=I.fromDateTimes(l,t),x=I.fromDateTimes(t,l);let g="unknown";m.length("days")>3?g=Math.floor(m.length("days"))+" days ago":m.length("hours")>3?g=Math.floor(m.length("hours"))+" hours ago":m.length("minutes")>3?g=Math.floor(m.length("minutes"))+" min. ago":m.length("seconds")>=0&&(g=Math.floor(m.length("seconds"))+" sec. ago"),x.length("days")>3?g="in "+Math.floor(x.length("days"))+" days":x.length("hours")>3?g="in "+Math.floor(x.length("hours"))+" hours":x.length("minutes")>3?g="in "+Math.floor(x.length("minutes"))+" min.":x.length("seconds")>0&&(g="in "+Math.floor(x.length("seconds"))+" sec.");let w=l.toFormat("yyyy-LL-dd HH:mm:ss");return l.toFormat("yyyy-LL-dd")===u.toFormat("yyyy-LL-dd")&&(w=l.toFormat("HH:mm:ss")),r="Iso date: "+l.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),h(c,w,g,r)}catch(l){return h(c,"error",`${l}`,`${l}`)}};class ee{constructor(t,n){b(this,"chunk");b(this,"chunkNo");b(this,"hidden");b(this,"timeShown");b(this,"timeHidden");this.chunk=t,this.chunkNo=n,this.hidden=!1,this.timeShown=j.now(),this.timeHidden=null}}const k=s=>{const t=n=>q(n,{minimumFractionDigits:3});return e.jsx("span",{title:`${s.bytes} bytes`,children:t(s.bytes)})},ne=s=>{const t=s.chunkWrapper.chunkNo,n=s.chunkWrapper.chunk,[c,o]=d.useState(!1);S.useEffect(()=>{setTimeout(()=>{o(!s.chunkWrapper.hidden)},100)},[s.chunkWrapper.hidden]);const i=n.downloaded/n.toDownload*100;let r="progress-chunk";return c?r+=" progress-chunk-visible":r+=" progress-chunk-hidden",e.jsx("div",{className:r,children:e.jsxs("div",{className:"progress-chunk-inner",children:[e.jsxs("div",{className:"progress-chunk-header",children:[e.jsxs("div",{children:["Chunk no ",t]}),e.jsxs("div",{children:["Downloaded: ",e.jsx(k,{bytes:n.downloaded}),"/",e.jsx(k,{bytes:n.toDownload})]}),e.jsxs("div",{children:["Unpack: ",e.jsx(k,{bytes:n.unpacked}),"/",e.jsx(k,{bytes:n.toUnpack})]})]}),e.jsx(F,{striped:!0,variant:"success",now:i})]})})},se=s=>{const t=s.lastFile;return e.jsxs("div",{className:"last-file-entry",children:[e.jsxs("div",{className:"last-file-entry-header",children:[e.jsx("div",{className:"last-file-entry-no",children:t.fileNo}),e.jsx("div",{className:"last-file-entry-size",children:e.jsx(k,{bytes:t.fileSize})}),t.finished?e.jsx("div",{className:"last-file-entry-finished",children:"Finished"}):e.jsx("div",{className:"last-file-entry-finished",children:"Not finished"})]}),e.jsx("div",{className:"last-file-entry-name",children:t.fileName})]})},te=()=>{const{backendSettings:s}=d.useContext(U),t=X(),[n,c]=d.useState(null),[o,i]=d.useState(0),[r,h]=d.useState({}),[l,u]=d.useState(!1),m=d.useCallback(p=>{for(const f in r){const a=r[f];if(a.chunk.downloaded==a.chunk.toDownload&&a.chunk.unpacked==a.chunk.toUnpack){if(a.timeHidden&&j.now().diff(a.timeHidden,"seconds").seconds>3&&!(f in p.currentChunks)){delete r[f];continue}!a.hidden&&j.now().diff(a.timeShown,"seconds").seconds>2&&(a.hidden=!0,a.timeHidden=j.now())}else f in p.currentChunks?a.chunk=p.currentChunks[f]:(a.chunk.downloaded=a.chunk.toDownload,a.chunk.unpacked=a.chunk.toUnpack)}},[c,r,h,u]),x=d.useCallback(async()=>{try{const f=await(await E(s,"/progress")).json(),a=f.progress;c(f.progress),m(f.progress),(a.finishTime?j.fromISO(a.finishTime):null)&&u(!0);for(const N in a.currentChunks)if(!(N in r)){const $=a.currentChunks[N],W=parseInt(N);r[N]=new ee($,W)}h(r)}catch(p){console.log(p),c(null)}},[c,r,h,u]);S.useEffect(()=>{l?setTimeout(()=>{i(o+1),n&&m(n)},1e3):x().then(()=>{setTimeout(()=>{i(o+1)},1e3)})},[l,i,o,x]);function g(p,f){return e.jsx(ne,{chunkWrapper:f},f.chunkNo)}function w(p,f){return e.jsx(se,{lastFile:f},p)}if(n==null)return e.jsxs("div",{className:"progress-page",children:[e.jsx("h1",{children:"Vite template"}),e.jsxs("p",{children:["Connected to the endpoint ",s.backendUrl]}),e.jsxs("p",{children:["Frontend version ","0.1.0"]}),e.jsxs("p",{children:["Backend version ",t.version]}),e.jsx("p",{children:"Progress is null"})]});const T=n.downloaded/n.totalDownloadSize*100,C=j.fromISO(n.currentTime),y=n.etaSec,H=C.plus({seconds:y}),D=n.finishTime?j.fromISO(n.finishTime):null,M=j.fromISO(n.startTime);return e.jsxs("div",{className:"progress-page",children:[e.jsxs("div",{className:"progress-page-left",children:[e.jsxs("h4",{children:["Pipe downloader ",t.version]}),e.jsxs("p",{children:["endpoint ",s.backendUrl]}),e.jsxs("div",{className:"progress-page-dates",children:[e.jsx(B,{date:n.startTime,title:"Start time",minimal:!1}),e.jsx(B,{date:n.currentTime,title:"Update time",minimal:!1}),n.finishTime?e.jsx(B,{date:n.finishTime,title:"Finish time",minimal:!1}):e.jsx(B,{date:H.toISO(),title:"Estimated finish",minimal:!1})]}),e.jsxs("div",{className:"download-url",children:[e.jsx("div",{className:"header",children:"Downloading file:"}),e.jsx("input",{readOnly:!0,value:n.downloadUrl})]}),D?e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully Downloaded:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.downloaded})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully unpacked:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Successfully unpacked files:"}),e.jsx("td",{children:n.unpackedFiles})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Elapsed time:"}),e.jsx("td",{children:D.diff(M).toFormat("hh:mm:ss")})]})]})})}):e.jsx("div",{children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Download speed:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.currentDownloadSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpack speed:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.currentUnpackSpeed}),"/s"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Downloaded:"}),e.jsxs("td",{children:[e.jsx(k,{bytes:n.downloaded}),"/",e.jsx(k,{bytes:n.totalDownloadSize})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Unpacked:"}),e.jsx("td",{children:e.jsx(k,{bytes:n.unpacked})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Files unpacked:"}),e.jsx("td",{children:n.unpackedFiles})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Percent downloaded:"}),e.jsxs("td",{children:[T.toFixed(5),"%"]})]})]})})}),e.jsx(F,{striped:!0,variant:"success",now:T}),n.lastUnpackedFiles.slice(0).reverse().map((p,f)=>w(f,p))]}),e.jsxs("div",{className:"progress-page-right",children:[!n.serverChunkSupport&&e.jsxs("div",{className:"progress-chunk-not-possible",children:[e.jsx(V,{}),e.jsx("div",{className:"progress-chunk-not-possible-label",children:"Multi-connection download not possible due to lack of support on server"})]}),e.jsxs("div",{className:"progress-page-right-header",children:[e.jsxs("div",{children:["Chunks left: ",n.chunksLeft]}),e.jsxs("div",{children:["finished: ",n.chunksTotal-n.chunksLeft]}),e.jsxs("div",{children:["Active: ",Object.keys(r).length]}),e.jsxs("div",{children:["Download threads: ",n.downloadThreads]})]}),Object.entries(r).reverse().map(([p,f])=>g(parseInt(p),f))]})]})},re=()=>{const s=R();return s.error?e.jsxs("div",{children:[e.jsx("div",{children:s.error}),e.jsx(Z,{})]}):s.config==null?e.jsxs("div",{children:["Loading... ",s.progress]}):e.jsx("div",{children:e.jsx("div",{children:e.jsx(te,{})})})},O=document.getElementById("root");if(!O)throw new Error("No root element found");const P=_.createRoot(O),oe=document.baseURI;oe.includes("/frontend/")?P.render(e.jsx(S.StrictMode,{children:e.jsx(Q,{children:e.jsx(Y,{children:e.jsx(G,{basename:"/frontend/",children:e.jsx(J,{children:e.jsx(K,{path:"/*",element:e.jsx(re,{})})})})})})})):P.render(e.jsx("div",{children:e.jsxs("p",{children:["Invalid base URI, navigate to ","/frontend/"]})}));
